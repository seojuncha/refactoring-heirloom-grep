# Heirloom grep 1차 리팩토링 보고서
**작성자:** 차서준 (Cha Seojun)  
**작성일:** August 2025  


## 1. 개요
- **프로젝트:** Heirloom grep 1차 리팩토링  
- **기간:** 4일  
- **목적:** 레거시 코드 구조 단순화, 실행파일 분리, 유지보수성 향상  
- **결과 요약:** 동작 유지 + 구조 단순화 + 확장성 확보  


## 2. 문제 정의
- 단일 `grep.c`에 모든 로직과 `main()` 포함  
- `grep`, `egrep`, `fgrep` 실행파일이 동일 소스에서 취사선택  
- 전역 변수 과다 사용 → 결합도 높음  
- 실행파일 간 책임 불명확 → 유지보수/테스트 어려움  


## 3. 개선 목표
- 실행파일별 진입점(main) 분리  
- 공통 로직은 **라이브러리화(libgrep.a)**  
- 퍼블릭 인터페이스(`public.h`)와 내부 구현 구분  
- const 적용으로 안전성 확보  
- 옵션 파싱 분리 → 테스트 용이성 향상  
- 정적 분석 및 코드 스타일 도구 적용으로 품질 개선  
- 자동화된 테스트 기반 구축  

## 4. 개선 작업
1. **Main 분리**  
   - `grep_main.c`, `egrep_main.c`, `fgrep_main.c` 생성  
   - `grep_run()` API 추가  

2. **Public API 도입**  
   - `public.h` 작성 → `grep_run()`, `progname` 선언  

3. **const 적용**  
   - 불변 문자열/테이블을 `const`로 승격  

4. **빌드 구조 개선**  
   - `libgrep.a` 생성 → 실행파일들은 얇은 main + 라이브러리 링크  
   - `.o` 파일들은 임시 `obj` 폴더에 생성
   - `libcommon.a`, `libuxre.a` 라이브러리 빌드는 상위 Make에서 함께 빌드

5. **테스트 파일 및 스크립트 추가**  
   - 간단한 입력/출력 케이스를 포함한 테스트 파일 작성  
   - 자동으로 테스트 파일을 생성하는 스크립트 추가  

6. **정적 분석 도구 스크립트 추가**  
   - `clang-tidy`와 `cppcheck` 리포트 자동 생성 스크립트 작성  
   - 주요 경고/리포트를 포트폴리오에 포함 가능하도록 정리  

7. **Smoke 테스트 및 메모리 검사**  
   - 호스트 시스템의 `grep`과 결과를 비교하는 smoke 테스트 스크립트 작성  
   - `valgrind` 실행 스크립트 추가 → 메모리 오류 및 리포트 생성  

8. **코드 스타일 정리**  
   - `clang-format` 적용 → 일관된 코드 스타일 확보  


## 5. 성과
- **구조 단순화:** 실행파일 책임 분리  
- **안정성 강화:** const 적용, 전역 직접 의존성 감소  
- **테스트 기반 확보:** 테스트 파일 및 자동 실행 스크립트로 회귀 테스트 가능  
- **품질 관리 체계화:** clang-tidy, cppcheck 리포트 생성 → 정적 분석 자동화  
- **실행 안정성 검증:** smoke 테스트 및 valgrind 리포트로 동작/메모리 안정성 보장  
- **일관성 강화:** clang-format 적용 → 코드 스타일 일관 유지  
- **확장성 확보:** 후속 리팩토링(엔진 vtable, internal 헤더 모듈화) 준비 완료  
- **리스크 최소화:** 기능 변경 없이 구조와 품질만 개선  

## 6. 향후 개선 방향
- 전역 변수 가시성 정리 (public vs internal 헤더 분리)  
- 엔진 선택 로직 vtable 패턴 적용  
- I/O 모듈화, 테스트 자동화 확장 (CI 통합)  
- 정적 분석/테스트 리포트를 GitHub Actions와 연계  

## 7. 부록
- 빌드 로그 및 테스트 결과 동일 확인  
- 샘플 diff 예시: main 분리 전후  
- clang-tidy / cppcheck 리포트 샘플  
- smoke 테스트 및 valgrind 리포트 일부 캡처 